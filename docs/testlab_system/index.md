# テストラボシステム

## 目的

コンテナフォーマットに対応したシステムの一例として、テストラボシステムを紹介します。
テストラボシステムは、コンテナフォーマットを活用してセンサーからデータを取得し、その結果を表示することができるシステムです。
ここでは、システムの構成、構築手順、および動作手順について説明しています。

テストラボシステムを例としてコンテナフォーマットを体験し、
コンテナフォーマット標準化を価値を活用可能になることを目的としています。

## 機能概要

テストラボシステムで実現している機能は以下です。

1. スマートフォンのジャイロセンサ(加速度、傾き)の値を入力する
2. ジャイロセンサのデータをコンテナに変換する
3. 流通させたコンテナから値を取り出す
4. センサデータを可視化する

上記の機能を実現するために、コンテナフォーマットに関わる実装をしています。

- センサーデータ取得及びコンテナ化機能(スマートフォンのセンサを利用したコンテナフォーマット出力機能)
- スキーマリポジトリ機能の実装
- コンテナ処理機能の実装（スキーマリポジトリ機能と連携）

## システム構成

テストラボシステムの構成を示します。

![システム構成](environment/overview_on_pc.drawio.png)

_図 1: システム構成_

コンテナフォーマットを扱うシステムは多くの場合、図 1: の様に３層の構造です。
それぞれの層は、センサによるデータの収集、センサのデータを集めて処理をするエッジ層、サービスやリポジトリが置かれるクラウド層になります。
//TODO くらうど層は データ蓄積とリポジトリ


テストラボシステムでは、すべての機能を１つのコンピュータ上で動作させることが可能です。
しかしながら、実際のシステムでは各機能を分散して動作させることや、他の層の機能を別の層で動作させることも可能です。


また、メッセージング機能をハブとして、各機能間を接続してシステムを実現しています。

- センサーデータ取得及びコンテナ化機能
  - スマートフォンのジャイロセンサ(加速度、傾き)の情報を取得します
  - センサデータをコンテナにして送信します。
- メッセージング機能
  - PubSub と呼ばれる形式でデータのメッセージングを行う機能です。
    - トピックにデータを Publish(発行)する機能。
    - トピックを Subscribe(購読)して処理する機能。
    - 名前付き論理チャネル。
  - トピックに流れたデータを外部のデータソースに蓄積する。
  - SQL を用いた演算やタイムスタンプの付与。
- コンテナ処理機能
  - コンテナを受信し、可視化のためのデータを送信します。
  - スキーマリポジトリ機能を参照し、コンテナの構造に従ってデータを取り出します。
- スキーマリポジトリ機能
  - コンテナの構造を定義したファイルを管理、配布します。
  - コンテナの構造を定義するための画面も提供します。
- 可視化機能
  - コンテナ処理機能が処理したデータを DB に格納します。
  - DB に格納されたデータを可視化します。
  

## 利用上の注意

テストラボシステムと呼称するソフトウェア群は以下の注意事項があります。

:::caution
[Container Format で示された仕様](./spec_guide)と差異があります。  
国際標準化の過程で内容が更新されたためです。

_表： テストラボシステム実装と IEC63430 の差異の一覧_

| 項目     | 仕様                                                      | テストラボシステム実装                                  |
| -------- | --------------------------------------------------------- | ------------------------------------------------------- |
| 名称変更 | Data ID Type                                              | Data Index                                              |
| 仕様変更 | コンテナヘッダ内の Data ID の長さは Data ID Length で示す | Data ID の長さは Data Index の値に対応した値            |
| 仕様変更 | Data ID Length をヘッダに持つ                             | Data ID Length がヘッダにない                           |
| 仕様違反 | Container Type として決められた値群がある                 | Container Type に認められてない値(`0x0000`)を入れている |

標準化の検討中に Data Index(Data ID Type) の値から仕様で決められた長さの Data ID になる設計が検討されていました。
しかし、Data ID の長さを可変にするため、コンテナヘッダに Data ID Length フィールドを追加されています。

:::
